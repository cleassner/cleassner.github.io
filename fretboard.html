<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Fretboard Visualizer</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState } = React;

    const FretboardVisualizer = () => {
      const urlParams = new URLSearchParams(window.location.search);
      const urlKey = urlParams.get('key');
      const urlScale = urlParams.get('scale');
      
      const [selectedKey, setSelectedKey] = useState(urlKey || 'C');
      const [selectedScale, setSelectedScale] = useState(urlScale || 'Major');
      const [showIntervals, setShowIntervals] = useState(false);
      
      const allKeys = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'F#', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B', 'C#'];
      const chromaticSharps = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
      
      const noteToIndex = {
        'C': 0, 'B#': 0, 'C#': 1, 'Db': 1, 'D': 2, 'D#': 3, 'Eb': 3,
        'E': 4, 'Fb': 4, 'F': 5, 'E#': 5, 'F#': 6, 'Gb': 6, 'G': 7,
        'G#': 8, 'Ab': 8, 'A': 9, 'A#': 10, 'Bb': 10, 'B': 11, 'Cb': 11
      };
      
      const scaleFormulas = {
        'Major': { intervals: [0, 2, 4, 5, 7, 9, 11], degrees: [1, 2, 3, 4, 5, 6, 7] },
        'Minor (Natural)': { intervals: [0, 2, 3, 5, 7, 8, 10], degrees: [1, 2, 'b3', 4, 5, 'b6', 'b7'] },
        'Melodic Minor': { intervals: [0, 2, 3, 5, 7, 9, 11], degrees: [1, 2, 'b3', 4, 5, 6, 7] },
        'Harmonic Minor': { intervals: [0, 2, 3, 5, 7, 8, 11], degrees: [1, 2, 'b3', 4, 5, 'b6', 7] },
        'Ionian (Major)': { intervals: [0, 2, 4, 5, 7, 9, 11], degrees: [1, 2, 3, 4, 5, 6, 7] },
        'Dorian': { intervals: [0, 2, 3, 5, 7, 9, 10], degrees: [1, 2, 'b3', 4, 5, 6, 'b7'] },
        'Phrygian': { intervals: [0, 1, 3, 5, 7, 8, 10], degrees: [1, 'b2', 'b3', 4, 5, 'b6', 'b7'] },
        'Lydian': { intervals: [0, 2, 4, 6, 7, 9, 11], degrees: [1, 2, 3, '#4', 5, 6, 7] },
        'Mixolydian': { intervals: [0, 2, 4, 5, 7, 9, 10], degrees: [1, 2, 3, 4, 5, 6, 'b7'] },
        'Aeolian (Natural Minor)': { intervals: [0, 2, 3, 5, 7, 8, 10], degrees: [1, 2, 'b3', 4, 5, 'b6', 'b7'] },
        'Locrian': { intervals: [0, 1, 3, 5, 6, 8, 10], degrees: [1, 'b2', 'b3', 4, 'b5', 'b6', 'b7'] },
        'Dorian b2 (Phrygian #6)': { intervals: [0, 1, 3, 5, 7, 9, 10], degrees: [1, 'b2', 'b3', 4, 5, 6, 'b7'] },
        'Lydian Augmented': { intervals: [0, 2, 4, 6, 8, 9, 11], degrees: [1, 2, 3, '#4', '#5', 6, 7] },
        'Lydian Dominant': { intervals: [0, 2, 4, 6, 7, 9, 10], degrees: [1, 2, 3, '#4', 5, 6, 'b7'] },
        'Mixolydian b6 (Hindu)': { intervals: [0, 2, 4, 5, 7, 8, 10], degrees: [1, 2, 3, 4, 5, 'b6', 'b7'] },
        'Locrian #2 (Half Diminished)': { intervals: [0, 2, 3, 5, 6, 8, 10], degrees: [1, 2, 'b3', 4, 'b5', 'b6', 'b7'] },
        'Altered (Super Locrian)': { intervals: [0, 1, 3, 4, 6, 8, 10], degrees: [1, 'b2', 'b3', 'b4', 'b5', 'b6', 'b7'] },
        'Locrian #6': { intervals: [0, 1, 3, 5, 6, 9, 10], degrees: [1, 'b2', 'b3', 4, 'b5', 6, 'b7'] },
        'Ionian #5': { intervals: [0, 2, 4, 5, 8, 9, 11], degrees: [1, 2, 3, 4, '#5', 6, 7] },
        'Dorian #4': { intervals: [0, 2, 3, 6, 7, 9, 10], degrees: [1, 2, 'b3', '#4', 5, 6, 'b7'] },
        'Phrygian Dominant': { intervals: [0, 1, 4, 5, 7, 8, 10], degrees: [1, 'b2', 3, 4, 5, 'b6', 'b7'] },
        'Lydian #2': { intervals: [0, 3, 4, 6, 7, 9, 11], degrees: [1, '#2', 3, '#4', 5, 6, 7] },
        'Ultralocrian (Superlocrian bb7)': { intervals: [0, 1, 3, 4, 6, 8, 9], degrees: [1, 'b2', 'b3', 'b4', 'b5', 'b6', 'bb7'] },
        'Pentatonic Major': { intervals: [0, 2, 4, 7, 9], degrees: [1, 2, 3, 5, 6] },
        'Pentatonic Minor': { intervals: [0, 3, 5, 7, 10], degrees: [1, 'b3', 4, 5, 'b7'] },
        'Blues': { intervals: [0, 3, 5, 6, 7, 10], degrees: [1, 'b3', 4, 'b5', 5, 'b7'] },
        'Whole Tone': { intervals: [0, 2, 4, 6, 8, 10], degrees: [1, 2, 3, '#4', '#5', 'b7'] },
        'Diminished (W-H)': { intervals: [0, 2, 3, 5, 6, 8, 9, 11], degrees: [1, 2, 'b3', 4, 'b5', '#5', 6, 7] },
        'Diminished (H-W)': { intervals: [0, 1, 3, 4, 6, 7, 9, 10], degrees: [1, 'b2', 'b3', 3, '#4', 5, 6, 'b7'] }
      };
      
      const buildScale = (root, scaleType) => {
        const formula = scaleFormulas[scaleType];
        const rootIndex = noteToIndex[root];
        const notes = [];
        const intervals = [];
        const letters = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
        const rootLetter = root[0];
        const rootLetterIndex = letters.indexOf(rootLetter);
        
        formula.intervals.forEach((interval, i) => {
          const targetIndex = (rootIndex + interval) % 12;
          const degreeOffset = i;
          const targetLetter = letters[(rootLetterIndex + degreeOffset) % 7];
          let correctNote = null;
          const possibleNotes = [targetLetter, targetLetter + 'b', targetLetter + '#', targetLetter + 'bb', targetLetter + '##'];
          
          for (const note of possibleNotes) {
            if (noteToIndex[note] === targetIndex) {
              correctNote = note;
              break;
            }
          }
          
          if (!correctNote) correctNote = chromaticSharps[targetIndex];
          notes.push(correctNote);
          intervals.push(formula.degrees[i]);
        });
        
        return { notes, intervals };
      };
      
      const currentScale = buildScale(selectedKey, selectedScale);
      const tuning = ['E', 'A', 'D', 'G', 'B', 'E'];
      const numFrets = 15;
      
      const getNoteAt = (stringNote, fret) => {
        const startIndex = noteToIndex[stringNote];
        const targetIndex = (startIndex + fret) % 12;
        return chromaticSharps[targetIndex];
      };
      
      const noteIsInScale = (note) => {
        const noteIdx = noteToIndex[note];
        return currentScale.notes.some(scaleNote => noteToIndex[scaleNote] === noteIdx);
      };
      
      const noteIsRoot = (note) => {
        return noteToIndex[note] === noteToIndex[selectedKey];
      };
      
      const getIntervalForNote = (note) => {
        const noteIdx = noteToIndex[note];
        const scaleNoteIdx = currentScale.notes.findIndex(scaleNote => noteToIndex[scaleNote] === noteIdx);
        return scaleNoteIdx !== -1 ? currentScale.intervals[scaleNoteIdx] : null;
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-4">
          <div className="max-w-7xl mx-auto">
            <div className="flex items-center justify-between mb-6 flex-wrap gap-4">
              <div>
                <h1 className="text-4xl font-bold text-white mb-2">Fretboard Scale Visualizer</h1>
                <p className="text-purple-300">See any scale across the entire neck</p>
              </div>
              <a href="index.html" className="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-colors">
                ← Back to Practice
              </a>
            </div>
            
            <div className="bg-gray-800 rounded-lg p-6 mb-6 shadow-2xl border border-purple-500">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                  <label className="text-purple-300 text-sm font-bold mb-2 block">Key/Root</label>
                  <select value={selectedKey} onChange={(e) => setSelectedKey(e.target.value)} className="w-full bg-gray-700 text-white px-4 py-3 rounded-lg text-lg font-bold border-2 border-purple-500">
                    {allKeys.map(k => <option key={k} value={k}>{k}</option>)}
                  </select>
                </div>
                
                <div>
                  <label className="text-purple-300 text-sm font-bold mb-2 block">Scale/Mode</label>
                  <select value={selectedScale} onChange={(e) => setSelectedScale(e.target.value)} className="w-full bg-gray-700 text-white px-4 py-3 rounded-lg text-lg font-bold border-2 border-purple-500">
                    <optgroup label="Basic Scales">
                      <option value="Major">Major</option>
                      <option value="Minor (Natural)">Minor (Natural)</option>
                      <option value="Melodic Minor">Melodic Minor</option>
                      <option value="Harmonic Minor">Harmonic Minor</option>
                    </optgroup>
                    <optgroup label="Major Modes">
                      <option value="Ionian (Major)">Ionian (Major)</option>
                      <option value="Dorian">Dorian</option>
                      <option value="Phrygian">Phrygian</option>
                      <option value="Lydian">Lydian</option>
                      <option value="Mixolydian">Mixolydian</option>
                      <option value="Aeolian (Natural Minor)">Aeolian (Natural Minor)</option>
                      <option value="Locrian">Locrian</option>
                    </optgroup>
                    <optgroup label="Melodic Minor Modes">
                      <option value="Dorian b2 (Phrygian #6)">Dorian b2</option>
                      <option value="Lydian Augmented">Lydian Augmented</option>
                      <option value="Lydian Dominant">Lydian Dominant</option>
                      <option value="Mixolydian b6 (Hindu)">Mixolydian b6</option>
                      <option value="Locrian #2 (Half Diminished)">Locrian #2</option>
                      <option value="Altered (Super Locrian)">Altered</option>
                    </optgroup>
                    <optgroup label="Harmonic Minor Modes">
                      <option value="Locrian #6">Locrian #6</option>
                      <option value="Ionian #5">Ionian #5</option>
                      <option value="Dorian #4">Dorian #4</option>
                      <option value="Phrygian Dominant">Phrygian Dominant</option>
                      <option value="Lydian #2">Lydian #2</option>
                      <option value="Ultralocrian (Superlocrian bb7)">Ultralocrian</option>
                    </optgroup>
                    <optgroup label="Pentatonic & Blues">
                      <option value="Pentatonic Major">Pentatonic Major</option>
                      <option value="Pentatonic Minor">Pentatonic Minor</option>
                      <option value="Blues">Blues</option>
                    </optgroup>
                    <optgroup label="Symmetrical">
                      <option value="Whole Tone">Whole Tone</option>
                      <option value="Diminished (W-H)">Diminished (W-H)</option>
                      <option value="Diminished (H-W)">Diminished (H-W)</option>
                    </optgroup>
                  </select>
                </div>
                
                <div>
                  <label className="text-purple-300 text-sm font-bold mb-2 block">Display</label>
                  <button onClick={() => setShowIntervals(!showIntervals)} className="w-full bg-gray-700 hover:bg-gray-600 text-white px-4 py-3 rounded-lg text-lg font-bold border-2 border-purple-500 transition-colors">
                    {showIntervals ? 'Show Notes' : 'Show Intervals'}
                  </button>
                </div>
              </div>
              
              <div className="text-center">
                <div className="text-white text-2xl font-bold mb-2">{selectedKey} {selectedScale}</div>
                <div className="text-purple-300 text-sm mb-1">Notes: {currentScale.notes.join(' - ')}</div>
                <div className="text-purple-400 text-xs">Intervals: {currentScale.intervals.join(' - ')}</div>
              </div>
            </div>
            
            <div className="bg-gray-800 rounded-lg p-4 md:p-8 shadow-2xl border border-purple-500 overflow-x-auto">
              <div style={{ minWidth: '900px' }}>
                <div className="flex mb-2">
                  <div style={{ width: '50px' }}></div>
                  {[...Array(numFrets + 1)].map((_, f) => (
                    <div key={f} className="flex-1 text-center text-gray-500 text-xs">
                      {[3, 5, 7, 9].includes(f) && '•'}
                      {f === 12 && '••'}
                      {f === 15 && '•'}
                    </div>
                  ))}
                </div>
                
                {[...tuning].reverse().map((str, i) => {
                  const actualStringIdx = tuning.length - 1 - i;
                  return (
                    <div key={i} className="flex items-center mb-2">
                      <div style={{ width: '50px' }} className="text-right pr-3 text-purple-300 font-bold text-sm">{str}</div>
                      
                      <div className="flex flex-1 relative" style={{ height: '48px' }}>
                        <div className="absolute left-0 right-0 bg-gray-400" style={{ top: '50%', transform: 'translateY(-50%)', height: `${1 + actualStringIdx * 0.4}px` }} />
                        
                        {[...Array(numFrets + 1)].map((_, fret) => {
                          const note = getNoteAt(str, fret);
                          const inScale = noteIsInScale(note);
                          const isRoot = noteIsRoot(note);
                          const interval = getIntervalForNote(note);
                          const scaleNote = currentScale.notes.find(n => noteToIndex[n] === noteToIndex[note]);
                          
                          return (
                            <div key={fret} className="flex-1 flex items-center justify-center relative" style={{ borderLeft: fret > 0 ? '2px solid #4b5563' : 'none', background: fret === 0 ? '#1f2937' : '#374151' }}>
                              {inScale && (
                                <div className={`relative z-10 rounded-full flex items-center justify-center text-xs font-bold ${isRoot ? 'bg-purple-500 text-white border-2 border-white' : 'bg-white text-gray-900'}`} style={{ width: isRoot ? '34px' : '26px', height: isRoot ? '34px' : '26px' }}>
                                  {showIntervals ? interval : (isRoot ? scaleNote : '')}
                                </div>
                              )}
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  );
                })}
                
                <div className="flex mt-2">
                  <div style={{ width: '50px' }}></div>
                  {[...Array(numFrets + 1)].map((_, f) => (
                    <div key={f} className="flex-1 text-center text-gray-500 text-xs font-bold">{f}</div>
                  ))}
                </div>
              </div>
            </div>
            
            <div className="mt-6 text-center text-gray-400 text-sm">
              <div className="flex items-center justify-center gap-6 flex-wrap">
                <span className="flex items-center gap-2">
                  <span className="w-6 h-6 bg-white rounded-full"></span>
                  Scale {showIntervals ? 'intervals' : 'notes'}
                </span>
                <span className="flex items-center gap-2">
                  <span className="w-8 h-8 bg-purple-500 border-2 border-white rounded-full"></span>
                  Root ({selectedKey})
                </span>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FretboardVisualizer />);
  </script>
</body>
</html>

